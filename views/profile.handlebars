<!DOCTYPE html>
<html>
    <head>
        <title>LetsXchange Profile</title>
        <link rel="icon" type="image/x-icon" href="../assets/ico/favicon.ico">
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link href="../css/styles.css" rel="stylesheet" type="text/css" />
        <link href="../css/profile.css" rel="stylesheet" type="text/css" />
        
        <link rel="stylesheet" type="text/css" href="../assets/svg/fontawesome-free-5.11.2-web/css/all.css" />
        
        <script src="../js/jquery-3.4.1.js"></script>
        <!-- sets nav active element by checkling page url -->
        <script src="../js/nav-active-page.js"></script>
      
    </head>
    <body>

        <header>
            {{#if auth}}
                {{> headerAuth}}
            {{else}}
                {{> header}}     
            {{/if}}
        </header>

        <main role="main">

            {{#if msg}}
                <span class='msg'>{{msg}}</span>
            {{/if}}
            
            <div class="time-greet">
                <h1 id="time-greet" style="display: inline-block"></h1>
                {{#if user}}
                    {{#if userData.forename}}
                        <h1 style="display: inline-block">, {{userData.forename}}!</h1>
                    {{else}}
                        <h1 style="display: inline-block">, {{userData.user}}!</h1>
                    {{/if}}
                {{/if}}
            </div>
            
            <!-- PROFILE -->
            <div id="profile-details">

                <!-- PROFILE EDIT -->
                <div class="edit-profile">

                    <!-- AVATAR (with margin-bottom) -->
                    <!-- img class="avatar" src="../assets/public/avatars/{{userData.user}}.png" alt="Image not found" onerror="this.onerror=null;this.src='../assets/image/default_avatar.png';" /> -->
                    <div class="profile-block">
                        <!-- default src is an image with the username as filename and .png format -->
                        <!-- if not found, the src points to the default avatar -->
                        <input type="image" class="avatar" onclick="editField(this)" name="avatar"
                            src="../assets/public/avatars/{{userData.user}}.png" alt="Image not found" 
                            onerror="this.onerror=null;this.src='../assets/image/default_avatar.png';" />
                        <!-- enctype="multipart/form-data" this value is required when you are using forms that have a file upload control
                        enctype = encoding type -->
                        <form action="/edit-avatar" method="post" enctype="multipart/form-data" id="avatar-form" hidden style="margin-bottom: 20px;">
                            <input type="file" name="avatar" required>
                            <input type="submit" value="Upload avatar">
                        </form>
                    </div>


                    <!-- USERNAME -->
                    <div class="profile-block">
                        <span class="category">Username: </span> <span class="value">{{userData.user}}</span>
                        <button class="edit" onclick="editField(this)" name="username">Edit</button>
                        <form action="/edit-username" method="post" id="username-form" hidden>
                            <input type="text" name="name" placeholder="Enter new username.." required minlength="3" maxlength="16">
                            <input type="submit" value="Update username">
                        </form>
                    </div>


                    <!-- EMAIL -->
                    <div class="profile-block">
                        <span class="category">Email: </span> <span class="value" id="email">{{userData.email}}</span>
                        <button class="edit" onclick="editField(this)" name="email">Edit</button>
                        <form action="/edit-email" method="post" id="email-form" hidden>
                            <input type="text" name="email" placeholder="Enter new email.." required>
                            <input type="submit" value="Update email">
                        </form>
                    </div>

                    <!-- NAME -->
                    <div class="profile-block">
                        <span class="category">Name: </span> <span class="value">{{userData.forename}} {{userData.surname}}</span>
                        <button class="edit" onclick="editField(this)" name="realname">Edit</button>
                        <form action="/edit-realname" method="post" id="realname-form" hidden>
                            <input type="text" name="forename" placeholder="First name.." required maxlength="32">
                            <input type="text" name="surname" placeholder="Surname (family name).." required maxlength="32">
                            <input type="submit" value="Update name">
                        </form>
                    </div>

                    <!-- COUNTRY -->
                    <div class="profile-block">
                        <span class="category">Country: </span> <span class="value">{{userData.country}}</span>
                        <button class="edit" onclick="editField(this)" name="country">Edit</button>
                        <form action="/edit-country" method="post" id="country-form" hidden>
                            <select name="country" required>
                                <option disabled selected value> -- select an option -- </option>
                                {{#each countries}}
                                <option value="{{this.name}}">{{this.name}} - {{this.code}}</option>
                                {{/each}}
                                <option value=''>N/A (other - not listed)</option>
                            </select>
                            <input type="submit" value="Update country">
                        </form>
                    </div>

                    <!-- CONTACT NUMBER -->
                    <div class="profile-block">
                        <span class="category">Mobile: </span> <span class="value">{{userData.mobile}}</span>
                        <button class="edit" onclick="editField(this)" name="mobile">Edit</button>
                        <form action="/edit-mobile" method="post" id="mobile-form" hidden>
                            <input type="number" name="mobile" placeholder="Enter new contact number.." required>
                            <input type="submit" value="Update mobile number">
                        </form>
                    </div>

                    <!-- GENDER -->
                    <div class="profile-block">
                        <span class="category">Gender: </span> <span class="value">{{userData.gender}}</span>
                        <button class="edit" onclick="editField(this)" name="gender">Edit</button>
                        <form action="/edit-gender" method="post" id="gender-form" hidden>
                            <select name="gender" required>
                                <option disabled selected value> -- select an option -- </option>
                                <option value='Male'>Male</option>
                                <option value='Female'>Female</option>
                                <option value='Not specified'>Not specified</option>
                            </select>
                            <input type="submit" value="Save">
                        </form>
                    </div>

                    <!-- PASSWORD -->
                    <div class="profile-block">
                        <button class="edit" onclick="editField(this)" name="pass" id="pass-form-button">Change password</button>
                        <form action="/edit-pass" method="post" id="pass-form" hidden>
                            <input type="password" name="pass" placeholder="Enter current password.." required>
                            <input type="password" name="passNew" id="password" placeholder="Enter new password.." required minlength="3" maxlength="100">
                            <input type="password" name="passNewConfirm" id="confirm_password" placeholder="Confirm new password.." required minlength="3" maxlength="100">
                            <input type="submit" value="Change password">
                        </form>
                    </div>

                </div>

            </div>

        </main>

        <footer>
            {{> footer}}
        </footer>
        <!-- scripts -->
        <script src="../js/time-greeting.js"></script>
        <script>
            function editField(button) {
                const form = document.getElementById(button.name + '-form');
                if (form.hasAttribute('hidden')) {
                    form.removeAttribute('hidden');
                    button.innerHTML='Cancel';
                } else {
                    form.setAttribute('hidden', true);
                    if (button.name == 'pass') {
                        button.innerHTML='Change password';
                    } else {
                        button.innerHTML='Edit';
                    }
                }
            }
        </script> 

        <!-- PASSWORD MATCH CHECK -->
        <script language='javascript' type='text/javascript'>
            var password = document.getElementById("password")
            , confirm_password = document.getElementById("confirm_password");

            function validatePassword(){
                if(password.value != confirm_password.value) {
                    confirm_password.setCustomValidity("Passwords Don't Match");
                } else {
                    confirm_password.setCustomValidity('');
                }
            }

            //onchange event - when the value of an element has been changed
            password.onchange = validatePassword;
            //onkeyup event - when keyboard button is released
            confirm_password.onkeyup = validatePassword;
        </script>
    </body>
</html>